(this.webpackJsonpbazamjam=this.webpackJsonpbazamjam||[]).push([[0],{124:function(e,t,n){"use strict";n.r(t);var i=n(1),c=n(18),a=n.n(c),o=(n(79),n(54),n(3)),r=n(7),s=n(50),u=n.n(s),d=(n(94),n(95),n(21)),l=n.n(d),j=n(30),h=n(26),b=n(34),f=n(32),O=function(){function e(t){Object(h.a)(this,e),this.recording=void 0,this.fs=void 0,this.recording=[],this.fs=t}return Object(b.a)(e,[{key:"addData",value:function(e){var t;(t=this.recording).push.apply(t,Object(f.a)(Array.from(e)))}},{key:"getRecording",value:function(){return this.recording}},{key:"clearRecording",value:function(){this.recording=[]}}]),e}(),m=new Float32Array(0),g=function(){function e(){var t=this;Object(h.a)(this,e),this.audioContext=void 0,this._nodes=void 0,this.nodeConnections=void 0,this.analyser=void 0,this.source=void 0,this.audioStream=void 0,this._timeBuffer=void 0,this._freqBuffer=void 0,this._recorder=void 0,this.audioActive=!1,this.FFT_SIZE=2048,this.SAMPLE_RATE=16e3,this.addSourceNode=function(){if(t.audioContext&&t.audioStream){var e=new MediaStreamAudioSourceNode(t.audioContext,{mediaStream:t.audioStream});t.addNode(e,"source",{outputs:["analyzer"]})}},this._nodes={},this.nodeConnections={},this._timeBuffer=new Float32Array(this.FFT_SIZE),this._freqBuffer=new Float32Array(this.FFT_SIZE/2),this._recorder=new O(this.SAMPLE_RATE)}return Object(b.a)(e,[{key:"nodes",get:function(){return this._nodes}},{key:"initAudio",value:function(){var e=Object(j.a)(l.a.mark((function e(){var t,n,i,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.audioContext&&(this.audioContext=new window.AudioContext({sampleRate:this.SAMPLE_RATE})),null==this._nodes.analyzer&&(i=new AnalyserNode(this.audioContext,{fftSize:this.FFT_SIZE}),this.addNode(i,"analyzer")),null!=this.audioStream&&(null===(t=this.audioStream)||void 0===t?void 0:t.active)){e.next=9;break}return e.next=5,navigator.mediaDevices.getUserMedia({audio:!0,video:!1});case 5:this.audioStream=e.sent,this.addSourceNode(),e.next=10;break;case 9:(null===(n=this.audioStream)||void 0===n?void 0:n.getTracks().every((function(e){return 0==e.enabled})))&&(null===(c=this.audioStream)||void 0===c||c.getTracks().forEach((function(e){return e.enabled=!0})));case 10:return null==this._nodes.source&&this.addSourceNode(),this.getTimeData.bind(this),this.getFreqData.bind(this),e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startRecording",value:function(){var e=Object(j.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initAudio();case 2:return t=e.sent,this.audioActive=t,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopRecording",value:function(){var e;null===(e=this.audioStream)||void 0===e||e.getTracks().forEach((function(e){return e.enabled=!1})),this.audioActive=!1}},{key:"getTimeData",value:function(){var e=this._nodes.analyzer;return e instanceof AnalyserNode?(e.getFloatTimeDomainData(this._timeBuffer),this._timeBuffer):m}},{key:"getFreqData",value:function(){var e=this._nodes.analyzer;return e instanceof AnalyserNode?(e.getFloatFrequencyData(this._freqBuffer),this._freqBuffer):m}},{key:"addNode",value:function(e,t,n){var i=this;if(t in this._nodes)throw new Error("Key already exists in audio graph");this._nodes[t]=e,(null===n||void 0===n?void 0:n.inputs)&&n.inputs.forEach((function(e){return i.connectNodes(e,t)})),(null===n||void 0===n?void 0:n.outputs)&&n.outputs.forEach((function(e){return i.connectNodes(t,e)}))}},{key:"nodeExists",value:function(e){return e in this._nodes}},{key:"connectNodes",value:function(e,t){if(!(e in this._nodes)&&!(t in this._nodes))throw new Error("At least one provided key is invalid");this._nodes[e].connect(this._nodes[t]),this.nodeConnections[e]=t}}]),e}(),v=g,x=n(4),p=n(2),y=["className","style","children"],S=Object(i.forwardRef)((function(e,t){var n=e.className,i=e.style,c=void 0===i?{}:i,a=(e.children,Object(x.a)(e,y)),r=a.text,s=void 0===r?"Hi there":r;return Object(p.jsx)("div",Object(o.a)(Object(o.a)({},a),{},{style:Object(o.a)({},c),className:n+" recorder",ref:t,children:Object(p.jsx)("div",{style:{textAlign:"center"},children:s})}))})),w=n(23);var _=function(e){var t,n=Object(i.useRef)(null),c=Object(i.useRef)(null),a=Object(i.useState)(),o=Object(r.a)(a,2),s=o[0],u=o[1],d=function(){c.current&&u({width:c.current.offsetWidth,height:c.current.offsetHeight})};Object(i.useLayoutEffect)((function(){d()}),[]),window.addEventListener("resize",(function(){clearInterval(t),t||(t=setTimeout(d,100))}));var l=e.isRecording&&null!=s;return Object(i.useLayoutEffect)((function(){if(l){var t,i=s,c=i.width,a=i.height,o=null===(t=n.current)||void 0===t?void 0:t.getContext("2d");null!=o&&(n.current.setAttribute("width",c.toString()),n.current.setAttribute("height",a.toString()),function(e,t,n,i){var c=0,a=n/t.length;e.strokeStyle="#ffffff",t.forEach((function(t,n){var o=t*i/2+i/2,r=5*a;e.fillRect(c,o,r,r),c+=a}))}(o,e.soundData,c,a))}}),[null===s||void 0===s?void 0:s.width,null===s||void 0===s?void 0:s.height,e.soundData[0],l]),Object(p.jsx)("div",{className:"timeDomGraph",ref:c,children:l&&Object(p.jsx)("canvas",{ref:n,width:s.width,height:s.height})})},N=["className","style","children"],A={recordOn:Object(p.jsx)(w.c,{size:100}),recordOff:Object(p.jsx)(w.d,{size:100}),pauseOn:Object(p.jsx)(w.b,{size:100}),pauseOff:Object(p.jsx)(w.a,{size:100})},C=Object(i.forwardRef)((function(e,t){var n=e.className,c=e.style,a=void 0===c?{}:c,s=e.children,u=Object(x.a)(e,N),d=Object(i.useState)(!1),l=Object(r.a)(d,2),j=l[0],h=l[1],b=Object(i.useState)(!1),O=Object(r.a)(b,2),m=(O[0],O[1],Object(i.useState)(new Float32Array(0))),g=Object(r.a)(m,2),v=g[0],y=g[1],S=Object(i.useState)(new Float32Array(0)),w=Object(r.a)(S,2),C=(w[0],w[1]),k=Object(i.useState)(),E=Object(r.a)(k,2),F=E[0],T=E[1],M=j?A.recordOn:A.recordOff,R=function(){var e=new Float32Array(u.audioManager.getTimeData());y(e),C((function(t){return new Float32Array([].concat(Object(f.a)(Array.from(t)),Object(f.a)(Array.from(e))))}))},z=u.audioManager.FFT_SIZE/u.audioManager.SAMPLE_RATE;return Object(i.useEffect)((function(){if(j){var e=setInterval(R,z);T(e)}else null!=F&&clearInterval(F)}),[j]),Object(p.jsxs)("div",Object(o.a)(Object(o.a)({},u),{},{style:Object(o.a)({},a),className:n+" recorder",ref:t,children:[Object(p.jsx)("div",{className:"recorder-controls",children:Object(p.jsx)("div",{onClick:function(){var e=!j;e?(u.audioManager.startRecording(),console.log("\n\nstarted\n")):(u.audioManager.stopRecording(),console.log("\n\nstopped\n")),h(e)},children:M})}),Object(p.jsx)(_,{soundData:v,isRecording:j}),s]}))})),k=Object(s.WidthProvider)(u.a),E={rowHeight:200,cols:3,verticalCompact:!0,isBounded:!0,onLayoutChange:function(){}},F={temp1:{element:S,props:{},layout:{i:"1",x:0,y:0,w:1,h:1}},temp2:{element:S,props:{},layout:{i:"2",x:1,y:1,w:1,h:1}}},T={i:"recorder",x:0,y:0,w:3,h:1,static:!0};var M=function(e){var t=Object(i.useState)(new v),n=Object(r.a)(t,2),c=n[0],a=(n[1],Object(i.useState)([F.temp1,F.temp2])),s=Object(r.a)(a,2),u=s[0],d=(s[1],Object(i.useMemo)((function(){return e=u,console.log("Components built"),e.map((function(e,t){return Object(i.createElement)(e.element,{props:e.props,className:"dashboard-component",key:e.layout.i,"data-grid":e.layout},e.children)}));var e}),[u]));return console.timeLog("dashboard"),Object(p.jsx)("div",{className:"dashboard",children:Object(p.jsxs)(k,Object(o.a)(Object(o.a)({className:"grid"},E),{},{children:[Object(p.jsx)(C,{className:"dashboard-component",audioManager:c,"data-grid":T},T.i),d]}))})},R=n(14),z=n(35),D=n(36),I=(n(105),n(68)),B=n(43),L=n(69),P=n(51),q=n(70),H={menuClosed:Object(p.jsx)(B.a,{}),menuOpen:Object(p.jsx)(B.b,{}),library:Object(p.jsx)(I.a,{}),settings:Object(p.jsx)(L.a,{}),sourceCode:Object(p.jsx)(B.c,{}),contact:Object(p.jsx)(w.e,{}),login:Object(p.jsx)(P.a,{}),logout:Object(p.jsx)(P.a,{}),midimouth:Object(p.jsx)(q.a,{})},J=function(e){var t=Object(i.useState)(1==e.isMobile),n=Object(r.a)(t,2),c=n[0],a=n[1],o=Object(z.b)(),s=o.loginWithRedirect,u=o.logout,d=o.isAuthenticated,l=c?"BzJ":"BazamJam",j=e.isMobile?"20px":"175px",h=c?H.menuClosed:H.menuOpen,b=d?function(){}:s,f=d?function(){}:s;return e.isMobile&&!c&&a(!0),Object(p.jsx)("div",{className:"sidebar",children:Object(p.jsxs)(R.c,{collapsed:c,width:j,children:[Object(p.jsx)(R.f,{className:"title-header",children:l}),Object(p.jsx)(R.d,{children:Object(p.jsxs)(R.a,{iconShape:"round",children:[!d&&Object(p.jsx)(R.b,{icon:H.login,onClick:function(){return s()},children:"Sign in"}),Object(p.jsx)(R.b,{icon:H.midimouth,children:Object(p.jsx)(D.b,{to:"/midi-mouth",children:"MidiMouth"})}),Object(p.jsx)(R.b,{icon:H.library,onClick:function(){return b()},children:d?Object(p.jsx)("a",{href:"https://omfgdogs.com/",children:"Library"}):"Library"}),Object(p.jsx)(R.b,{icon:H.settings,onClick:function(){return f()},children:d?Object(p.jsx)("a",{href:"https://omfgdogs.com/",children:"Settings"}):"Settings"}),Object(p.jsx)(R.b,{icon:h,onClick:function(){return a(!c)},children:"Minimize"})]})}),Object(p.jsx)(R.e,{children:Object(p.jsxs)(R.a,{iconShape:"round",children:[d&&Object(p.jsx)(R.b,{icon:H.logout,onClick:function(){return u({returnTo:window.location.origin})},children:"Log out"}),Object(p.jsx)(R.b,{icon:H.contact,children:Object(p.jsx)("a",{href:"mailto:davidhaas6@gmail.com",children:"Contact"})}),Object(p.jsx)(R.b,{icon:H.sourceCode,children:Object(p.jsx)("a",{href:"https://github.com/davidhaas6/bazamjam",children:"Source"})})]})})]})})},Z=function(e){return Object(p.jsxs)("div",{className:"App",children:[Object(p.jsx)(J,{}),Object(p.jsx)(M,{})]})},W=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,133)).then((function(t){var n=t.getCLS,i=t.getFID,c=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),i(e),c(e),a(e),o(e)}))},K=n(8),Q=n(131),U=n(52),Y=n.n(U),G=n(127),X=function(e){var t=Object(i.useState)(!0),n=Object(r.a)(t,2),c=n[0],a=n[1],o=e.variant||"success";return Object(p.jsx)(p.Fragment,{children:Object(p.jsxs)(G.a,{show:c,variant:o,onClose:function(){return a(!1)},dismissible:!0,children:[Object(p.jsx)(G.a.Heading,{children:e.header}),e.message]})})},V=(n(130),n(128)),$=n(132),ee=n(129),te=n(126);function ne(e,t,n){return 0===(e=e.trim()).length&&(e=t,n&&(e=n+" "+e)),e}var ie,ce=function(e){var t,n,c=Object(i.useState)(),a=Object(r.a)(c,2),o=a[0],s=a[1],u=Object(i.useState)(),d=Object(r.a)(u,2),h=d[0],b=d[1],f=Object(i.useState)(),O=Object(r.a)(f,2),m=O[0],g=O[1],v=Object(i.useState)(),x=Object(r.a)(v,2),y=x[0],S=x[1],w=Object(i.useState)(),_=Object(r.a)(w,2),N=_[0],A=_[1],C=Object(i.useState)(0),k=Object(r.a)(C,2),E=k[0],F=k[1],T=Object(i.useState)(),M=Object(r.a)(T,2),R=(M[0],M[1],Object(i.useState)(!1)),z=Object(r.a)(R,2),D=z[0],I=z[1],B=Object(i.useState)(""),L=Object(r.a)(B,2),P=L[0],q=L[1],H="-1",J=null!=m&&null!=h;o&&(t=Object.entries(o).map((function(e){var t=Object(r.a)(e,2),n=t[0],i=t[1];return Object(p.jsx)("option",{value:n,children:ne(i,n,"Song")})})));h&&(n=Object.entries(h).map((function(e){var t=Object(r.a)(e,2),n=t[0],i=t[1];return Object(p.jsx)("option",{value:n,children:ne(i,n,"Instrument")})})));function Z(){return(Z=Object(j.a)(l.a.mark((function t(){var n,i,c,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=new FormData).append("user_sample",N),console.log("formdata: ",Array.from(n.keys())),i={song_id:m,instrument_num:y,key_shift:E,all_tracks:y==H},c=Object.keys(i).map((function(e){return e+"="+i[e]})).join("&"),a=e.apiRoot+"create_song?"+c,console.log("fetching: "+a),I(!0),fetch(a,{method:"POST",body:n,headers:{accept:"application/json"}}).then((function(e){return e.json()})).then((function(t){console.log(t),e.setOutputSong(t.song),I(!1)}),(function(e){console.log(e),q(e.message)}));case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}Object(i.useEffect)((function(){fetch(e.apiRoot+"get_songs").then((function(e){return e.json()})).then((function(e){console.log(e),s(e)}),(function(e){console.log(e),q(e.message)}))}),[]),Object(i.useEffect)((function(){null!=m&&null!=o&&(S(H),console.log("Fetching instruments for: "+o[m]),fetch(e.apiRoot+"get_instruments?song_id="+m).then((function(e){return e.json()})).then((function(e){console.log(e),b(e)}),(function(e){console.log(e),q(e.message)})))}),[m]);return Object(p.jsx)("div",{className:"midi-form",children:Object(p.jsxs)(V.a,{onSubmit:function(e){if(e.preventDefault(),console.log("submitting"),!N)return q("Please select a sound file."),void console.log("no file selected");console.log("file: "+N),function(){Z.apply(this,arguments)}()},children:[P.length>0&&Object(p.jsx)(X,{message:P,variant:"danger",header:"Error"}),Object(p.jsxs)($.a,{className:"mb-3",children:[Object(p.jsx)($.a.Text,{children:"\ud83c\udfa4"}),Object(p.jsx)(V.a.Control,{type:"file",size:"lg",accept:".wav",onChange:function(e){return A(e.target.files[0])}})]}),Object(p.jsxs)($.a,{className:"mb-3",children:[Object(p.jsx)($.a.Text,{children:"\ud83c\udfbc"}),Object(p.jsxs)(V.a.Select,{size:"lg",onChange:function(e){return g(e.target.value)},children:[Object(p.jsx)("option",{disabled:!0,selected:!m,children:"Select a song"}),t]})]}),Object(p.jsxs)($.a,{className:"mb-3",children:[Object(p.jsx)($.a.Text,{children:"\ud83c\udfb7"}),Object(p.jsxs)(V.a.Select,{size:"lg",value:y,disabled:null==m,onChange:function(e){return S(e.target.value)},children:[J&&Object(p.jsx)("option",{value:H,children:"All Instruments"}),J?n:Object(p.jsx)("option",{children:"Must select a song"})]})]}),Object(p.jsx)(ee.a,{className:"mb-3",children:Object(p.jsxs)(ee.a.Item,{eventKey:"0",children:[Object(p.jsx)(ee.a.Header,{children:"Other Options"}),Object(p.jsxs)(ee.a.Body,{className:"midi-advanced-options",children:[Object(p.jsxs)($.a,{className:"mb-3",onChange:function(e){return F(e.target.value)},children:[Object(p.jsx)($.a.Text,{children:"Note Shift"}),Object(p.jsx)(V.a.Control,{type:"number",placeholder:"0"})]}),Object(p.jsx)($.a,{className:"mb-3",children:Object(p.jsx)(V.a.Check,{label:"Include drums"})})]})]})}),Object(p.jsx)("div",{className:"mb-3 text-center",children:Object(p.jsx)(te.a,{variant:"success",size:"lg",type:"submit",disabled:D,children:D?"Processing...":"Create Song \ud83d\udc44"})})]})})};!function(e){e[e.None=0]="None",e[e.Submitted=1]="Submitted",e[e.Success=2]="Success",e[e.Error=3]="Error"}(ie||(ie={}));var ae="https://bazamjam.uc.r.appspot.com/";var oe=function(){var e=Object(i.useState)(""),t=Object(r.a)(e,2),n=t[0],c=t[1],a=Object(i.useState)(ie.None),o=Object(r.a)(a,2),s=(o[0],o[1],n);return console.log(Y.a.canPlay(s)),Object(p.jsxs)("main",{className:"midi-main",children:[Object(p.jsx)("h1",{className:"midi-header",children:"Midi Mouth \ud83c\udfb6\ud83d\udc44\ud83c\udfb6"}),Object(p.jsx)(X,{header:"Howdy!",message:"Make a song with your voice! Choose a sound clip, song, and go!"}),Object(p.jsx)(ce,{apiRoot:ae,setOutputSong:c}),Object(p.jsx)("hr",{}),n.length>0&&Object(p.jsxs)(Q.a,{children:[Object(p.jsx)(Q.a.Header,{children:Object(p.jsx)("h3",{children:"Your song is ready!"})}),Object(p.jsx)(Q.a.Body,{children:Object(p.jsx)(Y.a,{url:s,config:{file:{forceAudio:!0}},controls:!0,height:50,width:300})})]})]})};a.a.render(Object(p.jsx)(z.a,{domain:"dev-9c8pon97.us.auth0.com",clientId:"cofJDIegnz1wWXwQiDA2Qda0lCQ4uKDL",redirectUri:window.location.origin,audience:"https://YOUR_DOMAIN/api/v2/",scope:"read:current_user update:current_user_metadata",children:Object(p.jsx)(D.a,{children:Object(p.jsxs)(K.c,{children:[Object(p.jsx)(K.a,{path:"/",element:Object(p.jsx)(Z,{})}),Object(p.jsx)(K.a,{path:"midi-mouth",element:Object(p.jsx)(oe,{})})]})})}),document.getElementById("root")),W()},54:function(e,t,n){},79:function(e,t,n){},94:function(e,t,n){},95:function(e,t,n){}},[[124,1,2]]]);
//# sourceMappingURL=main.aed94af2.chunk.js.map