(this.webpackJsonpbazamjam=this.webpackJsonpbazamjam||[]).push([[0],{124:function(e,t,n){"use strict";n.r(t);var c=n(1),i=n(18),a=n.n(i),s=(n(79),n(54),n(3)),r=n(7),o=n(51),u=n.n(o),d=(n(94),n(95),n(21)),l=n.n(d),j=n(31),h=n(26),b=n(36),O=n(33),f=function(){function e(t){Object(h.a)(this,e),this.recording=void 0,this.fs=void 0,this.recording=[],this.fs=t}return Object(b.a)(e,[{key:"addData",value:function(e){var t;(t=this.recording).push.apply(t,Object(O.a)(Array.from(e)))}},{key:"getRecording",value:function(){return this.recording}},{key:"clearRecording",value:function(){this.recording=[]}}]),e}(),m=new Float32Array(0),g=function(){function e(){var t=this;Object(h.a)(this,e),this.audioContext=void 0,this._nodes=void 0,this.nodeConnections=void 0,this.analyser=void 0,this.source=void 0,this.audioStream=void 0,this._timeBuffer=void 0,this._freqBuffer=void 0,this._recorder=void 0,this.audioActive=!1,this.FFT_SIZE=2048,this.SAMPLE_RATE=16e3,this.addSourceNode=function(){if(t.audioContext&&t.audioStream){var e=new MediaStreamAudioSourceNode(t.audioContext,{mediaStream:t.audioStream});t.addNode(e,"source",{outputs:["analyzer"]})}},this._nodes={},this.nodeConnections={},this._timeBuffer=new Float32Array(this.FFT_SIZE),this._freqBuffer=new Float32Array(this.FFT_SIZE/2),this._recorder=new f(this.SAMPLE_RATE)}return Object(b.a)(e,[{key:"nodes",get:function(){return this._nodes}},{key:"initAudio",value:function(){var e=Object(j.a)(l.a.mark((function e(){var t,n,c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.audioContext&&(this.audioContext=new window.AudioContext({sampleRate:this.SAMPLE_RATE})),null==this._nodes.analyzer&&(c=new AnalyserNode(this.audioContext,{fftSize:this.FFT_SIZE}),this.addNode(c,"analyzer")),null!=this.audioStream&&(null===(t=this.audioStream)||void 0===t?void 0:t.active)){e.next=9;break}return e.next=5,navigator.mediaDevices.getUserMedia({audio:!0,video:!1});case 5:this.audioStream=e.sent,this.addSourceNode(),e.next=10;break;case 9:(null===(n=this.audioStream)||void 0===n?void 0:n.getTracks().every((function(e){return 0==e.enabled})))&&(null===(i=this.audioStream)||void 0===i||i.getTracks().forEach((function(e){return e.enabled=!0})));case 10:return null==this._nodes.source&&this.addSourceNode(),this.getTimeData.bind(this),this.getFreqData.bind(this),e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startRecording",value:function(){var e=Object(j.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initAudio();case 2:return t=e.sent,this.audioActive=t,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopRecording",value:function(){var e;null===(e=this.audioStream)||void 0===e||e.getTracks().forEach((function(e){return e.enabled=!1})),this.audioActive=!1}},{key:"getTimeData",value:function(){var e=this._nodes.analyzer;return e instanceof AnalyserNode?(e.getFloatTimeDomainData(this._timeBuffer),this._timeBuffer):m}},{key:"getFreqData",value:function(){var e=this._nodes.analyzer;return e instanceof AnalyserNode?(e.getFloatFrequencyData(this._freqBuffer),this._freqBuffer):m}},{key:"addNode",value:function(e,t,n){var c=this;if(t in this._nodes)throw new Error("Key already exists in audio graph");this._nodes[t]=e,(null===n||void 0===n?void 0:n.inputs)&&n.inputs.forEach((function(e){return c.connectNodes(e,t)})),(null===n||void 0===n?void 0:n.outputs)&&n.outputs.forEach((function(e){return c.connectNodes(t,e)}))}},{key:"nodeExists",value:function(e){return e in this._nodes}},{key:"connectNodes",value:function(e,t){if(!(e in this._nodes)&&!(t in this._nodes))throw new Error("At least one provided key is invalid");this._nodes[e].connect(this._nodes[t]),this.nodeConnections[e]=t}}]),e}(),v=g,x=n(4),p=n(2),y=["className","style","children"],S=Object(c.forwardRef)((function(e,t){var n=e.className,c=e.style,i=void 0===c?{}:c,a=(e.children,Object(x.a)(e,y)),r=a.text,o=void 0===r?"Hi there":r;return Object(p.jsx)("div",Object(s.a)(Object(s.a)({},a),{},{style:Object(s.a)({},i),className:n+" recorder",ref:t,children:Object(p.jsx)("div",{style:{textAlign:"center"},children:o})}))})),w=n(23);var N=function(e){var t,n=Object(c.useRef)(null),i=Object(c.useRef)(null),a=Object(c.useState)(),s=Object(r.a)(a,2),o=s[0],u=s[1],d=function(){i.current&&u({width:i.current.offsetWidth,height:i.current.offsetHeight})};Object(c.useLayoutEffect)((function(){d()}),[]),window.addEventListener("resize",(function(){clearInterval(t),t||(t=setTimeout(d,100))}));var l=e.isRecording&&null!=o;return Object(c.useLayoutEffect)((function(){if(l){var t,c=o,i=c.width,a=c.height,s=null===(t=n.current)||void 0===t?void 0:t.getContext("2d");null!=s&&(n.current.setAttribute("width",i.toString()),n.current.setAttribute("height",a.toString()),function(e,t,n,c){var i=0,a=n/t.length;e.strokeStyle="#ffffff",t.forEach((function(t,n){var s=t*c/2+c/2,r=5*a;e.fillRect(i,s,r,r),i+=a}))}(s,e.soundData,i,a))}}),[null===o||void 0===o?void 0:o.width,null===o||void 0===o?void 0:o.height,e.soundData[0],l]),Object(p.jsx)("div",{className:"timeDomGraph",ref:i,children:l&&Object(p.jsx)("canvas",{ref:n,width:o.width,height:o.height})})},_=["className","style","children"],A={recordOn:Object(p.jsx)(w.c,{size:100}),recordOff:Object(p.jsx)(w.d,{size:100}),pauseOn:Object(p.jsx)(w.b,{size:100}),pauseOff:Object(p.jsx)(w.a,{size:100})},C=Object(c.forwardRef)((function(e,t){var n=e.className,i=e.style,a=void 0===i?{}:i,o=e.children,u=Object(x.a)(e,_),d=Object(c.useState)(!1),l=Object(r.a)(d,2),j=l[0],h=l[1],b=Object(c.useState)(!1),f=Object(r.a)(b,2),m=(f[0],f[1],Object(c.useState)(new Float32Array(0))),g=Object(r.a)(m,2),v=g[0],y=g[1],S=Object(c.useState)(new Float32Array(0)),w=Object(r.a)(S,2),C=(w[0],w[1]),k=Object(c.useState)(),E=Object(r.a)(k,2),F=E[0],M=E[1],R=j?A.recordOn:A.recordOff,T=function(){var e=new Float32Array(u.audioManager.getTimeData());y(e),C((function(t){return new Float32Array([].concat(Object(O.a)(Array.from(t)),Object(O.a)(Array.from(e))))}))},z=u.audioManager.FFT_SIZE/u.audioManager.SAMPLE_RATE;return Object(c.useEffect)((function(){if(j){var e=setInterval(T,z);M(e)}else null!=F&&clearInterval(F)}),[j]),Object(p.jsxs)("div",Object(s.a)(Object(s.a)({},u),{},{style:Object(s.a)({},a),className:n+" recorder",ref:t,children:[Object(p.jsx)("div",{className:"recorder-controls",children:Object(p.jsx)("div",{onClick:function(){var e=!j;e?(u.audioManager.startRecording(),console.log("\n\nstarted\n")):(u.audioManager.stopRecording(),console.log("\n\nstopped\n")),h(e)},children:R})}),Object(p.jsx)(N,{soundData:v,isRecording:j}),o]}))})),k=n(131),E=n(28),F=n.n(E),M=(n(130),n(128)),R=n(132),T=n(129),z=n(126),D=n(127),I=function(e){var t=Object(c.useState)(!0),n=Object(r.a)(t,2),i=n[0],a=n[1],s=e.variant||"success";return Object(p.jsx)(p.Fragment,{children:Object(p.jsxs)(D.a,{show:i,variant:s,onClose:function(){return a(!1)},dismissible:!0,children:[Object(p.jsx)(D.a.Heading,{children:e.header}),e.message]})})};function B(e,t,n){return 0===(e=e.trim()).length&&(e=t,n&&(e=n+" "+e)),e}var L,P=function(e){var t,n,i=Object(c.useState)(),a=Object(r.a)(i,2),s=a[0],o=a[1],u=Object(c.useState)(),d=Object(r.a)(u,2),h=d[0],b=d[1],O=Object(c.useState)(),f=Object(r.a)(O,2),m=f[0],g=f[1],v=Object(c.useState)(),x=Object(r.a)(v,2),y=x[0],S=x[1],w=Object(c.useState)(),N=Object(r.a)(w,2),_=N[0],A=N[1],C=Object(c.useState)(0),k=Object(r.a)(C,2),E=k[0],F=k[1],D=Object(c.useState)(),L=Object(r.a)(D,2),P=(L[0],L[1],Object(c.useState)(!1)),H=Object(r.a)(P,2),q=H[0],J=H[1],Z=Object(c.useState)(""),W=Object(r.a)(Z,2),K=W[0],Q=W[1],U="-1",Y=null!=m&&null!=h;s&&(t=Object.entries(s).map((function(e){var t=Object(r.a)(e,2),n=t[0],c=t[1];return Object(p.jsx)("option",{value:n,children:B(c,n,"Song")})})));h&&(n=Object.entries(h).map((function(e){var t=Object(r.a)(e,2),n=t[0],c=t[1];return Object(p.jsx)("option",{value:n,children:B(c,n,"Instrument")})})));function G(){return(G=Object(j.a)(l.a.mark((function t(){var n,c,i,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=new FormData).append("user_sample",_),console.log("formdata: ",Array.from(n.keys())),c={song_id:m,instrument_num:y,key_shift:E,all_tracks:y==U},J(!0),i=Object.keys(c).map((function(e){return e+"="+c[e]})).join("&"),a=e.apiRoot+"create_song?"+i,console.log("fetching: "+a),fetch(a,{method:"POST",body:n,headers:{accept:"application/json"}}).then((function(e){return e.json()})).then((function(t){console.log(t),e.setOutputSong(t.song)}),(function(e){console.log(e),Q(e.message)})).then((function(){J(!1)}));case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}Object(c.useEffect)((function(){fetch(e.apiRoot+"get_songs").then((function(e){return e.json()})).then((function(e){console.log(e),o(e)}),(function(e){console.log(e),Q(e.message)}))}),[]),Object(c.useEffect)((function(){null!=m&&null!=s&&(S(U),console.log("Fetching instruments for: "+s[m]),fetch(e.apiRoot+"get_instruments?song_id="+m).then((function(e){return e.json()})).then((function(e){console.log(e),b(e)}),(function(e){console.log(e),Q(e.message)})))}),[m]);return Object(p.jsx)("div",{className:"midi-form",children:Object(p.jsxs)(M.a,{onSubmit:function(e){if(e.preventDefault(),console.log("submitting"),!_)return Q("Please select a sound file."),void console.log("no file selected");console.log("file: "+_),function(){G.apply(this,arguments)}()},children:[K.length>0&&Object(p.jsx)(I,{message:K,variant:"danger",header:"Error"}),Object(p.jsxs)(R.a,{className:"mb-3",children:[Object(p.jsx)(R.a.Text,{children:"\ud83c\udfa4"}),Object(p.jsx)(M.a.Control,{type:"file",size:"lg",accept:".wav",onChange:function(e){return A(e.target.files[0])}})]}),Object(p.jsxs)(R.a,{className:"mb-3",children:[Object(p.jsx)(R.a.Text,{children:"\ud83c\udfbc"}),Object(p.jsxs)(M.a.Select,{size:"lg",onChange:function(e){return g(e.target.value)},children:[Object(p.jsx)("option",{disabled:!0,selected:!m,children:"Select a song"}),t]})]}),Object(p.jsxs)(R.a,{className:"mb-3",children:[Object(p.jsx)(R.a.Text,{children:"\ud83c\udfb7"}),Object(p.jsxs)(M.a.Select,{size:"lg",value:y,disabled:null==m,onChange:function(e){return S(e.target.value)},children:[Y&&Object(p.jsx)("option",{value:U,children:"All Instruments"}),Y?n:Object(p.jsx)("option",{children:"Must select a song"})]})]}),Object(p.jsx)(T.a,{className:"mb-3",children:Object(p.jsxs)(T.a.Item,{eventKey:"0",children:[Object(p.jsx)(T.a.Header,{children:"Other Options"}),Object(p.jsxs)(T.a.Body,{className:"midi-advanced-options",children:[Object(p.jsxs)(R.a,{className:"mb-3",onChange:function(e){return F(e.target.value)},children:[Object(p.jsx)(R.a.Text,{children:"Note Shift"}),Object(p.jsx)(M.a.Control,{type:"number",placeholder:"0"})]}),Object(p.jsx)(R.a,{className:"mb-3",children:Object(p.jsx)(M.a.Check,{label:"Include drums"})})]})]})}),Object(p.jsx)("div",{className:"mb-3 text-center",children:Object(p.jsx)(z.a,{variant:"success",size:"lg",type:"submit",disabled:q,children:q?"Processing...":"Create Song"})})]})})},H=["className","style","children"];!function(e){e[e.None=0]="None",e[e.Submitted=1]="Submitted",e[e.Success=2]="Success",e[e.Error=3]="Error"}(L||(L={}));var q="https://bazamjam.uc.r.appspot.com/";var J=Object(c.forwardRef)((function(e,t){var n=e.className,i=e.style,a=void 0===i?{}:i,o=(e.children,Object(x.a)(e,H)),u=Object(c.useState)(""),d=Object(r.a)(u,2),l=d[0],j=d[1],h=Object(c.useState)(L.None),b=Object(r.a)(h,2),O=(b[0],b[1],l);return console.log(F.a.canPlay(O)),Object(p.jsx)("div",Object(s.a)(Object(s.a)({},o),{},{style:Object(s.a)({},a),className:n+" midicomp",ref:t,children:Object(p.jsxs)("div",{className:"midi-main",children:[Object(p.jsx)("h1",{className:"midi-header",children:"Midi Mouth \ud83c\udfb6"}),Object(p.jsx)(P,{apiRoot:q,setOutputSong:j}),Object(p.jsx)("hr",{}),l.length>0&&Object(p.jsxs)(k.a,{children:[Object(p.jsx)(k.a.Header,{children:Object(p.jsx)("h3",{children:"Your song is ready!"})}),Object(p.jsx)(k.a.Body,{children:Object(p.jsx)(F.a,{url:O,config:{file:{forceAudio:!0}},controls:!0,height:50,width:300})})]})]})}))})),Z=Object(o.WidthProvider)(u.a),W={rowHeight:200,cols:3,verticalCompact:!0,isBounded:!0,onLayoutChange:function(){}},K={temp2:{element:S,props:{},layout:{i:"2",x:1,y:1,w:1,h:1}},midiMouth:{element:J,props:{},layout:{i:"1",x:0,y:0,w:1,h:3}}},Q=Object.values(K),U={i:"recorder",x:0,y:0,w:3,h:1,static:!0};var Y,G=function(e){var t=Object(c.useState)(new v),n=Object(r.a)(t,2),i=n[0],a=(n[1],Object(c.useState)(Q)),o=Object(r.a)(a,2),u=o[0],d=(o[1],Object(c.useMemo)((function(){return e=u,console.log("Components built"),e.map((function(e,t){return Object(c.createElement)(e.element,{props:e.props,className:"dashboard-component",key:e.layout.i,"data-grid":e.layout},e.children)}));var e}),[u]));return console.timeLog("dashboard"),Object(p.jsx)("div",{className:"dashboard",children:Object(p.jsxs)(Z,Object(s.a)(Object(s.a)({className:"grid"},W),{},{children:[Object(p.jsx)(C,{className:"dashboard-component",audioManager:i,"data-grid":U},U.i),d]}))})},X=n(14),V=n(39),$=n(40),ee=(n(123),n(71)),te=n(45),ne=n(72),ce=n(53),ie=n(73),ae={menuClosed:Object(p.jsx)(te.a,{}),menuOpen:Object(p.jsx)(te.b,{}),library:Object(p.jsx)(ee.a,{}),settings:Object(p.jsx)(ne.a,{}),sourceCode:Object(p.jsx)(te.c,{}),contact:Object(p.jsx)(w.e,{}),login:Object(p.jsx)(ce.a,{}),logout:Object(p.jsx)(ce.a,{}),midimouth:Object(p.jsx)(ie.a,{})},se=function(e){var t=Object(c.useState)(1==e.isMobile),n=Object(r.a)(t,2),i=n[0],a=n[1],s=Object(V.b)(),o=s.loginWithRedirect,u=s.logout,d=s.isAuthenticated,l=i?"BzJ":"BazamJam",j=e.isMobile?"20px":"175px",h=i?ae.menuClosed:ae.menuOpen,b=d?function(){}:o,O=d?function(){}:o;return e.isMobile&&!i&&a(!0),Object(p.jsx)("div",{className:"sidebar",children:Object(p.jsxs)(X.c,{collapsed:i,width:j,children:[Object(p.jsx)(X.f,{className:"title-header",children:l}),Object(p.jsx)(X.d,{children:Object(p.jsxs)(X.a,{iconShape:"round",children:[Object(p.jsx)(X.b,{icon:ae.library,onClick:function(){return b()},children:d?Object(p.jsx)("a",{href:"https://omfgdogs.com/",children:"Library"}):"Library"}),Object(p.jsx)(X.b,{icon:ae.midimouth,children:Object(p.jsx)($.b,{to:"/midi-mouth",children:"MidiMouth"})}),!d&&Object(p.jsx)(X.b,{icon:ae.login,onClick:function(){return o()},children:"Sign in"}),d&&Object(p.jsx)(X.b,{icon:ae.settings,onClick:function(){return O()},children:Object(p.jsx)("a",{href:"https://omfgdogs.com/",children:"Settings"})}),Object(p.jsx)(X.b,{icon:h,onClick:function(){return a(!i)},children:"Minimize"})]})}),Object(p.jsx)(X.e,{children:Object(p.jsxs)(X.a,{iconShape:"round",children:[d&&Object(p.jsx)(X.b,{icon:ae.logout,onClick:function(){return u({returnTo:window.location.origin})},children:"Log out"}),Object(p.jsx)(X.b,{icon:ae.contact,children:Object(p.jsx)("a",{href:"mailto:davidhaas6@gmail.com",children:"Contact"})}),Object(p.jsx)(X.b,{icon:ae.sourceCode,children:Object(p.jsx)("a",{href:"https://github.com/davidhaas6/bazamjam",children:"Source"})})]})})]})})},re=function(e){return Object(p.jsxs)("div",{className:"App",children:[Object(p.jsx)(se,{}),Object(p.jsx)(G,{})]})},oe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,133)).then((function(t){var n=t.getCLS,c=t.getFID,i=t.getFCP,a=t.getLCP,s=t.getTTFB;n(e),c(e),i(e),a(e),s(e)}))},ue=n(8);!function(e){e[e.None=0]="None",e[e.Submitted=1]="Submitted",e[e.Success=2]="Success",e[e.Error=3]="Error"}(Y||(Y={}));var de="https://bazamjam.uc.r.appspot.com/";var le=function(){var e=Object(c.useState)(""),t=Object(r.a)(e,2),n=t[0],i=t[1],a=Object(c.useState)(Y.None),s=Object(r.a)(a,2),o=(s[0],s[1],n);return console.log(F.a.canPlay(o)),Object(p.jsxs)("div",{className:"midi-app",children:[Object(p.jsx)(se,{}),Object(p.jsxs)("div",{className:"midi-main",children:[Object(p.jsx)("h1",{className:"midi-header",children:"Midi Mouth \ud83c\udfb6\ud83d\udc44\ud83c\udfb6"}),Object(p.jsx)(I,{header:"Howdy!",message:"Make a song with your voice! Choose a sound clip, song, and go!"}),Object(p.jsx)(P,{apiRoot:de,setOutputSong:i}),Object(p.jsx)("hr",{}),n.length>0&&Object(p.jsxs)(k.a,{children:[Object(p.jsx)(k.a.Header,{children:Object(p.jsx)("h3",{children:"Your song is ready!"})}),Object(p.jsx)(k.a.Body,{children:Object(p.jsx)(F.a,{url:o,config:{file:{forceAudio:!0}},controls:!0,height:50,width:300})})]})]})]})};a.a.render(Object(p.jsx)(V.a,{domain:"dev-9c8pon97.us.auth0.com",clientId:"cofJDIegnz1wWXwQiDA2Qda0lCQ4uKDL",redirectUri:window.location.origin,audience:"https://YOUR_DOMAIN/api/v2/",scope:"read:current_user update:current_user_metadata",children:Object(p.jsx)($.a,{children:Object(p.jsxs)(ue.c,{children:[Object(p.jsx)(ue.a,{path:"/",element:Object(p.jsx)(re,{})}),Object(p.jsx)(ue.a,{path:"/midi-mouth",element:Object(p.jsx)(le,{})})]})})}),document.getElementById("root")),oe()},54:function(e,t,n){},79:function(e,t,n){},94:function(e,t,n){},95:function(e,t,n){}},[[124,1,2]]]);
//# sourceMappingURL=main.c80708b3.chunk.js.map