(this.webpackJsonpbazamjam=this.webpackJsonpbazamjam||[]).push([[0],{27:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var s=n(1),i=n.n(s),r=n(17),a=n.n(r),o=n(4);n(27);var c,u=n(2),d=function(e){var t,n,i=Object(s.useState)(!1),r=Object(o.a)(i,2),a=r[0],c=r[1],d=function(){var e=Object(s.useState)(!1),t=Object(o.a)(e,2),n=t[0],i=t[1];return Object(s.useEffect)((function(){i(!0)}),[]),n}(),l=Object(s.useMemo)((function(){return new Audio("assets/sound/switch-on-2.wav")}),[]),h=Object(s.useMemo)((function(){return new Audio("assets/sound/switch-off-2.wav")}),[]);Object(s.useEffect)((function(){d&&(a?l.play():h.play())}),[a,l,h]),Object(s.useEffect)((function(){e.releaseCondition&&(c(!1),console.log("release condition executred"))}),[e.releaseCondition]),Object(s.useEffect)((function(){var t,n;a?null===e||void 0===e||null===(t=e.onPress)||void 0===t||t.call(e):(null===e||void 0===e||null===(n=e.onRelease)||void 0===n||n.call(e),console.log("release called"))}),[a]);var b=null!==(t=e.baseStyles)&&void 0!==t?t:"control-button";return b+=" "+(a?null!==(n=e.pressedStyles)&&void 0!==n?n:"cb-pressed":""),Object(u.jsx)("button",{className:b,onClick:function(){c((function(e){return!e}))},children:Object(u.jsx)("span",{children:a?e.pressedChild:e.notPressedChild})})},l=n(16),h=n(18),b=n(11),f=function(e){var t=Object(s.useContext)(D),n=40,i=Object(s.useMemo)((function(){return{play:Object(u.jsx)(b.c,{className:"cb-icon",size:42}),pause:Object(u.jsx)(b.b,{className:"cb-icon",size:40}),settings:Object(u.jsx)(b.d,{className:"cb-icon",size:38}),close:Object(u.jsx)(h.a,{className:"cb-icon",size:42}),widgets:Object(u.jsx)(b.a,{className:"cb-icon",size:38}),recorderPressed:Object(u.jsx)(l.a,{size:50}),recorderUnpressed:Object(u.jsx)(l.b,{size:50})}}),[n]);return Object(u.jsxs)("div",{className:"layout-section button-box",children:[Object(u.jsx)(d,{onPress:function(){t.startRecording(),e.setPanel("dashboard")},onRelease:function(){return t.stopRecording()},pressedChild:i.recorderPressed,notPressedChild:i.recorderUnpressed,releaseCondition:"dashboard"!==e.curPanel}),Object(u.jsx)(d,{notPressedChild:i.widgets,pressedChild:i.close,onPress:function(){e.setPanel("widgets")},onRelease:function(){"widgets"===e.curPanel&&e.setPanel("dashboard")},releaseCondition:"widgets"!==e.curPanel}),Object(u.jsx)(d,{notPressedChild:i.settings,pressedChild:i.close,onPress:function(){e.setPanel("settings")},onRelease:function(){"settings"===e.curPanel&&e.setPanel("dashboard")},releaseCondition:"settings"!==e.curPanel}),Object(u.jsx)(d,{notPressedChild:i.play,pressedChild:i.pause})]})},j=function(e){return Object(u.jsx)("div",{className:"inactive-display",children:" Press Play! "})},v=function(e){return Object(u.jsxs)("div",{className:"loading-display",children:[" Loading :",">"," "]})},p=function(e){var t=e.data,n=Object(s.useState)(),i=Object(o.a)(n,2),r=i[0],a=i[1],c=null!=(null===t||void 0===t?void 0:t.chords_key);Object(s.useEffect)((function(){c&&a((function(){return t.chords_key}))}),[null===t||void 0===t?void 0:t.chords_key]);var d=(c?"Current":"Past")+" Chord:";return Object(u.jsxs)("div",{className:"tonal-display",children:[Object(u.jsx)("br",{}),d,Object(u.jsx)("div",{className:"current-chord",children:r})]})},O="algo-processor";!function(e){e[e.INACTIVE=0]="INACTIVE",e[e.LOADING=1]="LOADING",e[e.ACTIVE=2]="ACTIVE",e[e.OTHER_ERR=3]="OTHER_ERR"}(c||(c={}));var x=function(e){var t,n=Object(s.useContext)(z),i=Object(s.useContext)(D),r=Object(s.useState)(!1),a=Object(o.a)(r,2),d=a[0],l=a[1],h=Object(s.useState)(!1),b=Object(o.a)(h,2),f=b[0],x=b[1],g=Object(s.useState)(c.INACTIVE),m=Object(o.a)(g,2),w=m[0],y=m[1],E=Object(s.useState)(),N=Object(o.a)(E,2),k=N[0],C=N[1];Object(s.useEffect)((function(){console.log("tuner subscripting to audio-active"),n.subscribe("audio-active",(function(e){return l(e)}))}),[n]);var A,_=w===c.LOADING;switch(Object(s.useEffect)((function(){if(d&&!i.nodeExists(O)){i.addWorklet(O,"workers/main-algo-worklet.js",(function(e){try{n.publish("tuner-message",e),C((function(){return e.data})),x(null!=e.data)}catch(e){console.log("error in onWorkletMsg: "+e)}}))}}),[_,d,i,n]),w){case c.INACTIVE:A=Object(u.jsx)(j,{}),d&&(y(c.LOADING),console.log("setting state to loading"));break;case c.LOADING:A=Object(u.jsx)(v,{}),f&&y(c.ACTIVE),d||y(c.INACTIVE);break;case c.ACTIVE:A=Object(u.jsx)(p,{data:k}),d||y(c.INACTIVE);break;case c.OTHER_ERR:default:A=Object(u.jsx)("div",{children:"error"})}return Object(u.jsx)("div",{className:null!==(t="dashboard "+e.className)&&void 0!==t?t:"",children:Object(u.jsxs)("div",{className:"tuner",children:[Object(u.jsx)("div",{className:"dash-header tuner-header",children:"BazamJam"}),A]})})},g=function(){return Object(u.jsx)("div",{className:"settings-box",children:"Settings!!"})},m=function(e){var t=Object(s.useContext)(D),n=e.isHidden,i=void 0!==n&&n,r=function(e,t,n){var i=Object(s.useRef)(null);return Object(s.useEffect)((function(){var s,r,a,o,c=null===(s=i.current)||void 0===s?void 0:s.getContext("2d");return window.requestAnimationFrame((function s(i){if(c){if(null==o&&(o=i),n&&a&&i-a<1/n*1e9)return;e(c,t),a=i,r=window.requestAnimationFrame(s)}})),function(){window.cancelAnimationFrame(r)}}),[e,t,n]),i}((function(e,t){if(null!=(null===t||void 0===t?void 0:t.getData)){var n=t.getData().reverse(),s=e.canvas.width,i=e.canvas.height,r=i/2+50,a=(s-8)/n.length;e.clearRect(0,0,s,i),e.fillStyle="black",e.lineWidth=1,e.shadowOffsetX=8,e.shadowOffsetY=16,e.shadowBlur=1,e.shadowColor="#00000022";e.beginPath();for(var o=0;o<n.length-1;o++){var c=(o+1)*a,u=n[o+1]*r+i/2;e.lineTo(c,u)}e.stroke()}}),{getData:function(){return t.getTimeData()}}),a="waveform"+(i?" hidden":"");return Object(u.jsx)(u.Fragment,{children:Object(u.jsx)("canvas",{ref:r,className:a})})},w=function(){return Object(u.jsx)("div",{className:"widget-box",children:"Widgets"})},y=n(22),E=n(6),N=n.n(E),k=n(9),C=n(13),A=n(14);function _(e,t,n){return I.apply(this,arguments)}function I(){return(I=Object(k.a)(N.a.mark((function e(t,n,s){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("registering worker"),e.next=4,t.audioWorklet.addModule(n,{credentials:"omit"});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.log("error adding worklet module:"+e.t0);case 9:return e.abrupt("return",new AudioWorkletNode(t,s));case 10:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}var P=new Float32Array(0),S=function(){function e(t){Object(C.a)(this,e),this.audioContext=void 0,this._nodes=void 0,this.nodeGraph=void 0,this.audioStream=void 0,this._timeBuffer=void 0,this._freqBuffer=void 0,this.pubsub=void 0,this.audioActive=!1,this.FFT_SIZE=16384,this.SAMPLE_RATE=44100,this.BUFFER_SIZE=this.FFT_SIZE,this.newSourceNode=function(e,t){return e.createMediaStreamSource(t)},this._nodes={},this.nodeGraph=new Map,this._timeBuffer=new Float32Array(this.FFT_SIZE),this._freqBuffer=new Float32Array(this.FFT_SIZE/2),this.pubsub=t}return Object(A.a)(e,[{key:"nodes",get:function(){return this._nodes}},{key:"initAudio",value:function(){var e=Object(k.a)(N.a.mark((function e(){var t,n;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.audioContext&&(this.audioContext=new window.AudioContext({sampleRate:this.SAMPLE_RATE})),this.nodeExists("analyzer")||(t=new AnalyserNode(this.audioContext,{fftSize:this.FFT_SIZE}),this.addNode(t,"analyzer")),null!=this.audioStream){e.next=10;break}return e.next=5,navigator.mediaDevices.getUserMedia({audio:!0,video:!1});case 5:this.audioStream=e.sent,n=this.newSourceNode(this.audioContext,this.audioStream),this.nodeExists("source")?this.replaceNode("source",n):this.addNode(n,"source",{outputs:["analyzer"]}),e.next=11;break;case 10:this.setTracksEnabled(!0);case 11:return this.getTimeData.bind(this),this.getFreqData.bind(this),e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startRecording",value:function(){var e=Object(k.a)(N.a.mark((function e(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initAudio();case 2:return this.audioActive=e.sent,this.pubsub.publish("audio-active",this.audioActive),e.abrupt("return",this.audioActive);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopRecording",value:function(){this.audioActive=!1,this.setTracksEnabled(!1),this.pubsub.publish("audio-active",this.audioActive)}},{key:"setTracksEnabled",value:function(e){var t;null===(t=this.audioStream)||void 0===t||t.getAudioTracks().forEach((function(t){return t.enabled=e}))}},{key:"getTimeData",value:function(){var e=this._nodes.analyzer;return e?(e.getFloatTimeDomainData(this._timeBuffer),this._timeBuffer):P}},{key:"getFreqData",value:function(){var e=this._nodes.analyzer;return e instanceof AnalyserNode?(e.getFloatFrequencyData(this._freqBuffer),this._freqBuffer):P}},{key:"addNode",value:function(e,t,n){var s=this;if(this.nodeExists(t))throw new Error("Key already exists in audio graph");this._nodes[t]=e,(null===n||void 0===n?void 0:n.inputs)&&n.inputs.forEach((function(e){return s.connectNodes(e,t)})),(null===n||void 0===n?void 0:n.outputs)&&n.outputs.forEach((function(e){return s.connectNodes(t,e)}))}},{key:"nodeExists",value:function(e){return e in this._nodes}},{key:"connectNodes",value:function(e,t){var n,s;if(!this.nodeExists(e)||!this.nodeExists(t))throw new Error("At least one provided key is invalid");(this._nodes[e].connect(this._nodes[t]),this.nodeGraph.has(e)||this.nodeGraph.set(e,[]),null===(n=this.nodeGraph.get(e))||void 0===n?void 0:n.includes(t))||(null===(s=this.nodeGraph.get(e))||void 0===s||s.push(t));console.log("added  ".concat(e," --\x3e ").concat(t))}},{key:"replaceNode",value:function(e,t){if(!this.nodeExists(e))throw new Error("Node key does not exist in audio graph");this._nodes[e].disconnect();var n=this.getInputNodesFor(e),s=this.nodeGraph.get(e);delete this._nodes[e],this.addNode(t,e,{outputs:s,inputs:n}),this._nodes[e]=t}},{key:"getInputNodesFor",value:function(e){var t=[];return this.nodeGraph.forEach((function(n,s){var i=n.filter((function(t){return t===e}));null!==i&&t.push.apply(t,Object(y.a)(i))})),t}},{key:"addWorklet",value:function(){var e=Object(k.a)(N.a.mark((function e(t,n,s){var i;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.audioContext&&!this.nodeExists(t)){e.next=3;break}return console.log("Can't add worklet - "+(this.audioContext?"Node exists":"Audio context null")),e.abrupt("return");case 3:return e.prev=3,e.next=6,_(this.audioContext,n,t);case 6:(i=e.sent).port.onmessage=s,this.addNode(i,t,{inputs:["source"]}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),console.log("Error adding worklet node:"+e.t0);case 14:case"end":return e.stop()}}),e,this,[[3,11]])})));return function(t,n,s){return e.apply(this,arguments)}}()}]),e}(),T=S,F=function(){function e(){Object(C.a)(this,e),this.subscribers={}}return Object(A.a)(e,[{key:"subscribe",value:function(e,t){this.subscribers[e]||(this.subscribers[e]=[]),this.subscribers[e].push(t),this.publish("subscriber-added",[e,t])}},{key:"publish",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];this.subscribers[e]&&this.subscribers[e].forEach((function(e){return e.apply(void 0,n)}))}}]),e}(),R=F,D=i.a.createContext(new T(new R)),z=i.a.createContext(new R),B=function(e){var t=Object(s.useMemo)((function(){return new R}),[]),n=Object(s.useMemo)((function(){return new T(t)}),[t]),i=Object(s.useState)("dashboard"),r=Object(o.a)(i,2),a=r[0],c=r[1];return console.log("panel: "+a),Object(u.jsx)(z.Provider,{value:t,children:Object(u.jsx)(D.Provider,{value:n,children:Object(u.jsx)("div",{className:"App",children:Object(u.jsxs)("div",{className:"box-body",children:[Object(u.jsxs)("div",{className:"layout-section info-box",children:["widgets"===a?Object(u.jsx)(w,{}):null,"settings"===a?Object(u.jsx)(g,{}):null,Object(u.jsx)(x,{className:"dashboard"!==a?"hidden":""})," "]}),Object(u.jsx)("div",{className:"layout-section display-box",children:Object(u.jsx)(m,{isHidden:"dashboard"!==a})}),Object(u.jsx)(f,{curPanel:a,setPanel:function(e){return c(e)}})]})})})})},G=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,39)).then((function(t){var n=t.getCLS,s=t.getFID,i=t.getFCP,r=t.getLCP,a=t.getTTFB;n(e),s(e),i(e),r(e),a(e)}))},M=n(19),L=n(20),V=n(3);a.a.render(Object(u.jsx)(M.a,{domain:"dev-9c8pon97.us.auth0.com",clientId:"cofJDIegnz1wWXwQiDA2Qda0lCQ4uKDL",redirectUri:window.location.origin,audience:"https://YOUR_DOMAIN/api/v2/",scope:"read:current_user update:current_user_metadata",children:Object(u.jsx)(L.a,{children:Object(u.jsx)(V.c,{children:Object(u.jsx)(V.a,{path:"/",element:Object(u.jsx)(B,{})})})})}),document.getElementById("root")),G()}},[[37,1,2]]]);
//# sourceMappingURL=main.c03c8756.chunk.js.map